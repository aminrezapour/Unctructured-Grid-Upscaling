<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GPRS: BILU0_C.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_E_3A_2FUsers_2Fhqpan_2FGPRS2X_2F.html">GPRS2X</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_E_3A_2FUsers_2Fhqpan_2FGPRS2X_2FPC_5FCODE_2F.html">PC_CODE</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_E_3A_2FUsers_2Fhqpan_2FGPRS2X_2FPC_5FCODE_2Fcode_2F.html">code</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_E_3A_2FUsers_2Fhqpan_2FGPRS2X_2FPC_5FCODE_2Fcode_2Futl_2F.html">utl</a></div>
<h1>BILU0_C.h File Reference</h1><code>#include &quot;<a class="el" href="MyMatrix_8h-source.html">MyMatrix.h</a>&quot;</code><br>
<code>#include &lt;ctime&gt;</code><br>
<code>#include &lt;fstream&gt;</code><br>

<p>
<a href="BILU0__C_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="BILU0__C_8h.html#a7ee2d64358a522207cb9dda48debb23">bilu0_c</a> (const int n, const double **a, const int *ja, const int *ia, const int *block_full_size, const int *block_imp_size, double **alu, int *jlu, int *ju, int *iw, int ierr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="BILU0__C_8h.html#68ae28ea4cd986c46cf87263d18e6ec0">blusol_c</a> (const int n, const double *b, double *x, double **alu, const int *jlu, const int *ju, const int *block_full_size, const int *block_imp_size, const int *block_index)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="BILU0__C_8h.html#3521a6ad1cf2eea5346a876608f71db4">bcsrcsc2_c</a> (int n, int n2, int job, int ipos, double **a, int *ja, int *ia, double **ao, int *jao, int *iao)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structSimRPT.html">SimRPT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="BILU0__C_8h.html#c88bb3a9595edec29279bb26af45b456">simRPT</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="3521a6ad1cf2eea5346a876608f71db4"></a><!-- doxytag: member="BILU0_C.h::bcsrcsc2_c" ref="3521a6ad1cf2eea5346a876608f71db4" args="(int n, int n2, int job, int ipos, double **a, int *ja, int *ia, double **ao, int *jao, int *iao)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void bcsrcsc2_c           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>n2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>job</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>ipos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double **&nbsp;</td>
          <td class="mdname" nowrap> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ja</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ia</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double **&nbsp;</td>
          <td class="mdname" nowrap> <em>ao</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>jao</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>iao</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment"><a name="l00184"></a>00184 {
<a name="l00185"></a>00185         <span class="keywordtype">int</span> i, j, k;    <span class="keywordtype">int</span> next;
<a name="l00186"></a>00186         <span class="keywordflow">for</span>(i=0; i&lt;n2+1; i++)   iao[i] = 0;
<a name="l00187"></a>00187         <span class="keywordflow">for</span>(i=0; i&lt;n; i++)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189                 <span class="keywordflow">for</span>(k=ia[i]; k&lt;ia[i+1];k++)
<a name="l00190"></a>00190                 {
<a name="l00191"></a>00191                         j = ja[k]+1;
<a name="l00192"></a>00192                         iao[j]++;
<a name="l00193"></a>00193                 }                
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         <span class="comment">// --- compute pointers from lengths ----</span>
<a name="l00196"></a>00196         iao[0] = ipos;
<a name="l00197"></a>00197         <span class="keywordflow">for</span>(i=0; i&lt;n2; i++)     iao[i+1] += iao[i]; 
<a name="l00198"></a>00198         
<a name="l00199"></a>00199         <span class="comment">// -------- now do the actual copying ----------------------------- </span>
<a name="l00200"></a>00200         <span class="keywordflow">for</span>( i=0; i&lt;n; i++)
<a name="l00201"></a>00201         {
<a name="l00202"></a>00202                 <span class="keywordflow">for</span>( k=ia[i]; k&lt;ia[i+1]; k++)
<a name="l00203"></a>00203                 {
<a name="l00204"></a>00204                         j = ja[k];
<a name="l00205"></a>00205                         next = iao[j];
<a name="l00206"></a>00206                         <span class="keywordflow">if</span> (job == 1)  ao[next] = a[k];
<a name="l00207"></a>00207                         jao[next] = i;
<a name="l00208"></a>00208                         iao[j] = next+1;
<a name="l00209"></a>00209                 }
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211         <span class="comment">// ------- reshift iao and leave ---------------------- </span>
<a name="l00212"></a>00212         <span class="keywordflow">for</span>( i=n2-1; i&gt;=0; i--)         iao[i+1] = iao[i];
<a name="l00213"></a>00213         iao[0] = ipos;
<a name="l00214"></a>00214 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7ee2d64358a522207cb9dda48debb23"></a><!-- doxytag: member="BILU0_C.h::bilu0_c" ref="a7ee2d64358a522207cb9dda48debb23" args="(const int n, const double **a, const int *ja, const int *ia, const int *block_full_size, const int *block_imp_size, double **alu, int *jlu, int *ju, int *iw, int ierr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int bilu0_c           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname" nowrap> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const double **&nbsp;</td>
          <td class="mdname" nowrap> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ja</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ia</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>block_full_size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>block_imp_size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double **&nbsp;</td>
          <td class="mdname" nowrap> <em>alu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>jlu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ju</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>iw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>ierr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment"><a name="l00015"></a>00015                       : First n elements are the diagonal elements of each row 
<a name="l00016"></a>00016 <span class="comment">//                                      (Here we get inverse for computaional efficience) followed </span>
<a name="l00017"></a>00017 <span class="comment">//                                      by a unused space, then all offdiagonal elements.               </span>
<a name="l00018"></a>00018 <span class="comment">//       jlu[nElems+1]: First n+1 elements are the index of first non-zero off-diagonal </span>
<a name="l00019"></a>00019 <span class="comment">//                                      elements of all rows. Rest are the col-index of each off-diagonal.</span>
<a name="l00020"></a>00020 <span class="comment">//       ju[nA+1]:              the index of non-zero off-diag elem just after the diag elem</span>
<a name="l00021"></a>00021 <span class="comment">//                                      of all rows. </span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024         <span class="keywordtype">int</span> ju0 = n+1;          <span class="comment">// Start index for off-diagonal elems</span>
<a name="l00025"></a>00025         <span class="keywordtype">int</span> i, ii, j, jj;       <span class="comment">// loop variables </span>
<a name="l00026"></a>00026         <span class="keywordtype">int</span> js;
<a name="l00027"></a>00027         <span class="keywordtype">int</span> jcol;
<a name="l00028"></a>00028         jlu[0] = ju0;
<a name="l00029"></a>00029         
<a name="l00030"></a>00030         <span class="comment">// iw: length of row, it stores index of each non-zero in alu array. (help you locate)</span>
<a name="l00031"></a>00031         <span class="keywordflow">for</span>  ( i=0; i&lt;n;i++ )   iw[i] = 0; 
<a name="l00032"></a>00032         
<a name="l00033"></a>00033         <span class="comment">// main loop, loop on rows</span>
<a name="l00034"></a>00034         <span class="keywordflow">for</span> ( ii=0; ii&lt;n; ii++) 
<a name="l00035"></a>00035         {
<a name="l00036"></a>00036                 <span class="comment">// the ind of starting off-diag elem of current row</span>
<a name="l00037"></a>00037                 js = ju0;       
<a name="l00038"></a>00038 
<a name="l00039"></a>00039                 <span class="comment">// go through the elements of one row , "ia" is the row_ptr</span>
<a name="l00040"></a>00040                 <span class="comment">// copy row ii of matrix { a, ja, ia } into row ii of alu, jlu (L/U) matrix.</span>
<a name="l00041"></a>00041                 <span class="keywordflow">for</span> ( j=ia[ii]; j&lt;ia[ii+1]; j++)        
<a name="l00042"></a>00042                 {
<a name="l00043"></a>00043                         <span class="comment">// jcol = col_ind of element j;</span>
<a name="l00044"></a>00044                         jcol = ja[j];           
<a name="l00045"></a>00045                         
<a name="l00046"></a>00046                         <span class="keywordflow">if</span> ( jcol == ii)                <span class="comment">// if it's diagonal element</span>
<a name="l00047"></a>00047                         {       
<a name="l00048"></a>00048                                 alu[ii] = (<span class="keywordtype">double</span>*) a[j];               <span class="comment">// put it at the beginning of 'alu'</span>
<a name="l00049"></a>00049                                 iw[jcol] = ii;          <span class="comment">// iw[jcol] = jcol;</span>
<a name="l00050"></a>00050                                 ju[ii] = ju0;           
<a name="l00051"></a>00051                         }
<a name="l00052"></a>00052                         <span class="keywordflow">else</span>                                    <span class="comment">// if it isn't diagonal element</span>
<a name="l00053"></a>00053                         {
<a name="l00054"></a>00054                                 alu[ju0] = (<span class="keywordtype">double</span>*) a[j];      <span class="comment">// put it into the later part of alu</span>
<a name="l00055"></a>00055                                 jlu[ju0] = ja[j];       <span class="comment">// copy the column index</span>
<a name="l00056"></a>00056                                 iw[jcol] = ju0;         
<a name="l00057"></a>00057                                 ju0 = ju0+1;
<a name="l00058"></a>00058                         }
<a name="l00059"></a>00059                 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061                 <span class="comment">// ---------------- ABOVE: COPY PART; BELOW: COMPUTING PART ---------------------- //</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063                 jlu[ii+1] = ju0;        <span class="comment">// 1st n+1 elems: ind of 1st off-diag elem of each rows.                </span>
<a name="l00064"></a>00064                 <span class="keywordtype">int</span> jf = ju0-1;
<a name="l00065"></a>00065                 <span class="keywordtype">int</span> jm = ju[ii]-1;      <span class="comment">// the index of last elements of L part of each row</span>
<a name="l00066"></a>00066                 <span class="keywordtype">double</span>* tl = <span class="keyword">new</span> <span class="keywordtype">double</span>[2500]; <span class="comment">// large enough for reservoir simulation</span>
<a name="l00067"></a>00067                 <span class="keywordflow">for</span> ( j=js; j&lt;=jm; j++ )                <span class="comment">// so, it goes through the L part of each row</span>
<a name="l00068"></a>00068                 {
<a name="l00069"></a>00069                         <span class="keywordtype">int</span> jrow = jlu[j];
<a name="l00070"></a>00070                         
<a name="l00071"></a>00071                         <span class="comment">// Original code  : double tl = alu[j]*alu[jrow];       // alu[j] off-diag &amp; alu[jrow] diag </span>
<a name="l00072"></a>00072                         <span class="comment">// alu[j] ~ (ii, jlu[j])</span>
<a name="l00073"></a>00073                         <span class="comment">// alu[jrow] ~ (jlu[j], jlu[j]) 'square'</span>
<a name="l00074"></a>00074                         <span class="comment">// tl ~ (ii, jlu[j])</span>
<a name="l00075"></a>00075                         <a class="code" href="MyMatrix_8h.html#499714a7ac42a61cf2ce36670322ef1c">calcAequBC</a>(block_imp_size[ii], block_imp_size[jrow], block_imp_size[jrow],
<a name="l00076"></a>00076                                                                  tl,block_full_size[ii], alu[j], block_full_size[ii], alu[jrow], block_full_size[jlu[j]]);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079                         <span class="comment">// Original code  : alu[j] = tl;                        //~~~~~~~~~~~~~~ </span>
<a name="l00080"></a>00080                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilp = 0; ilp &lt; block_full_size[ii]*block_full_size[jrow]; ilp++)       alu[j][ilp] = tl[ilp]; <span class="comment">// can be improved</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082                         <span class="comment">//perform linear combination</span>
<a name="l00083"></a>00083                         <span class="keywordflow">for</span> ( jj = ju[jrow]; jj&lt; jlu[jrow+1]; jj++ )    <span class="comment">// it goes through the U part of each row</span>
<a name="l00084"></a>00084                         {
<a name="l00085"></a>00085                                 <span class="keywordtype">int</span> jw = iw[jlu[jj]];                                   
<a name="l00086"></a>00086                                 <span class="comment">// Original code  : alu[jw] -= tl*alu[jj];      //~~~~~~~</span>
<a name="l00087"></a>00087                                 <span class="comment">// tl ~ (ii, jlu[j]) ~ (ii, jrow) </span>
<a name="l00088"></a>00088                                 <span class="comment">// alu[jj] ~ ( jrow, jlu(jj) )</span>
<a name="l00089"></a>00089                                 <span class="comment">// alu[jw] ~  ( ii, jlu(jj) )</span>
<a name="l00090"></a>00090                                 <span class="keywordflow">if</span> ( jw != 0 )
<a name="l00091"></a>00091                                         <a class="code" href="MyMatrix_8h.html#d928ae17cf328548377b20f81dba2a05">calcA_BC</a>(block_imp_size[ii], block_imp_size[jlu[jj]], block_imp_size[jrow],
<a name="l00092"></a>00092                                                          alu[jw],block_full_size[ii], tl,block_full_size[ii], alu[jj], block_full_size[jrow]);
<a name="l00093"></a>00093                         }
<a name="l00094"></a>00094                         
<a name="l00095"></a>00095                 }
<a name="l00096"></a>00096                 <span class="keyword">delete</span>[] tl;
<a name="l00097"></a>00097                         
<a name="l00098"></a>00098                 <span class="comment">// Original Code : if (alu[ii] == 0.0)  return ierr = ii;// exit of function, error in zero pivot</span>
<a name="l00099"></a>00099                         
<a name="l00100"></a>00100                 <span class="comment">// Original code  : alu[ii] = 1.0/alu[ii];              //invert  and store diagonal element.//~~~~</span>
<a name="l00101"></a>00101                 <span class="comment">// D = inv(D), --- D(n, n) --</span>
<a name="l00102"></a>00102                 <span class="comment">// void calcDinv(int n, double *D, int ldd)</span>
<a name="l00103"></a>00103                 <span class="keywordflow">if</span>(!<a class="code" href="MyMatrix_8h.html#2442254ca46db4288d3e709762aaa668">calcDinv</a>(block_imp_size[ii], alu[ii], block_full_size[ii])) 
<a name="l00104"></a>00104                 {
<a name="l00105"></a>00105                         cout &lt;&lt; <span class="stringliteral">"Breakdown in bilu0_c() cell : "</span>&lt;&lt; ii &lt;&lt;endl;           <span class="comment">// D = inv(D), it is possible to return 0 here,</span>
<a name="l00106"></a>00106                                                                                                                                                 <span class="comment">// which is very confusing;</span>
<a name="l00107"></a>00107                         <span class="keywordflow">return</span> ii+1;
<a name="l00108"></a>00108                 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110                 iw[ii] = 0;                     <span class="comment">// reset pointer iw to zero</span>
<a name="l00111"></a>00111                 <span class="keywordflow">for</span>( i = js; i&lt;= jf; i++)       iw[jlu[i]] = 0;
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113         <span class="keywordflow">return</span>  ierr = 0;
<a name="l00114"></a>00114 }       
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="68ae28ea4cd986c46cf87263d18e6ec0"></a><!-- doxytag: member="BILU0_C.h::blusol_c" ref="68ae28ea4cd986c46cf87263d18e6ec0" args="(const int n, const double *b, double *x, double **alu, const int *jlu, const int *ju, const int *block_full_size, const int *block_imp_size, const int *block_index)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void blusol_c           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname" nowrap> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const double *&nbsp;</td>
          <td class="mdname" nowrap> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double *&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double **&nbsp;</td>
          <td class="mdname" nowrap> <em>alu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>jlu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>ju</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>block_full_size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>block_imp_size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const int *&nbsp;</td>
          <td class="mdname" nowrap> <em>block_index</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment"><a name="l00120"></a>00120 {
<a name="l00121"></a>00121         <span class="keywordtype">double</span>* rwork = <span class="keyword">new</span> <span class="keywordtype">double</span>[100];
<a name="l00122"></a>00122         <span class="keywordtype">double</span> *<a class="code" href="EnumDef_8h.html#974e5a26488a879fee5914c4ffe0c7177fc56270e7a70fa81a5935b72eacbe29">A</a>, *B, *C, *D;
<a name="l00123"></a>00123         <span class="keywordtype">int</span> i, j, k, m, l, lldb;        
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="comment">// forward solve</span>
<a name="l00126"></a>00126         <span class="keywordflow">for</span>( i=0; i&lt;n; i++)
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128                 <span class="comment">// original code : x[i] = b[i];</span>
<a name="l00129"></a>00129                 <span class="keywordflow">for</span> ( j = block_index[i]; j &lt; block_index[i+1]; j++)    x[j] = b[j];
<a name="l00130"></a>00130                 <span class="comment">// original code : for ( k=jlu[i]; k&lt;ju[i]; k++)        x[i] -= alu[k]* x[jlu[k]];</span>
<a name="l00131"></a>00131                 <span class="keywordflow">for</span> ( k=jlu[i]; k&lt;ju[i]; k++)   
<a name="l00132"></a>00132                 {
<a name="l00133"></a>00133 <span class="comment">//                              calcA_BC(block_imp_size[i], 1, block_imp_size[jlu[k]], x+block_index[i], block_imp_size[i],</span>
<a name="l00134"></a>00134 <span class="comment">//                                               alu[k], block_full_size[i], x+block_index[jlu[k]], block_imp_size[jlu[k]]);</span>
<a name="l00135"></a>00135                                 A = x+block_index[i];
<a name="l00136"></a>00136                                 B = alu[k];
<a name="l00137"></a>00137                                 C = x+block_index[jlu[k]];                              
<a name="l00138"></a>00138                                 lldb = 0;
<a name="l00139"></a>00139                                 <span class="keywordflow">for</span>(l=0; l&lt;block_imp_size[jlu[k]]; l++) 
<a name="l00140"></a>00140                                 {
<a name="l00141"></a>00141                                         <span class="keywordflow">for</span>(m=0; m&lt;block_imp_size[i]; m++)      A[m] -= C[l]*B[lldb+m];                 
<a name="l00142"></a>00142                                         lldb += block_full_size[i];
<a name="l00143"></a>00143                                 }
<a name="l00144"></a>00144                 }
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146         <span class="comment">// backward solve.</span>
<a name="l00147"></a>00147         <span class="keywordflow">for</span>( i=n-1; i&gt;=0; i--)
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149                 <span class="comment">// original code : for( k=ju[i]; k&lt;jlu[i+1]; k++)       x[i] -= alu[k]*x[jlu[k]];</span>
<a name="l00150"></a>00150                 <span class="keywordflow">for</span> ( k=ju[i]; k&lt;jlu[i+1]; k++) 
<a name="l00151"></a>00151                 {
<a name="l00152"></a>00152 <span class="comment">//                              calcA_BC(block_imp_size[i], 1, block_imp_size[jlu[k]], x+block_index[i], block_imp_size[i],</span>
<a name="l00153"></a>00153 <span class="comment">//                                               alu[k], block_full_size[i], x+block_index[jlu[k]], block_imp_size[jlu[k]]);</span>
<a name="l00154"></a>00154                                 A = x+block_index[i];
<a name="l00155"></a>00155                                 B = alu[k];
<a name="l00156"></a>00156                                 C = x+block_index[jlu[k]];                              
<a name="l00157"></a>00157                                 lldb = 0;
<a name="l00158"></a>00158                                 <span class="keywordflow">for</span>(l=0; l&lt;block_imp_size[jlu[k]]; l++) 
<a name="l00159"></a>00159                                 {
<a name="l00160"></a>00160                                         <span class="keywordflow">for</span>(m=0; m&lt;block_imp_size[i]; m++)      A[m] -= C[l]*B[lldb+m];                 
<a name="l00161"></a>00161 <span class="comment">//                                      for(m=0; m&lt;block_imp_size[i]; m++)      x[block_index[i]+m] -= C[l]*B[lldb+m]; // do not know why this does not work.</span>
<a name="l00162"></a>00162                                         lldb += block_full_size[i];
<a name="l00163"></a>00163                                 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165                 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167                 <span class="comment">// original code : x[i] *= alu[i];      // x[i] = alu[i] * x;   </span>
<a name="l00168"></a>00168                 <span class="comment">// inline void calcDB(int n, int m, const double *D, int ldd, double *B, int ldb, double *rwork, int lrwork)</span>
<a name="l00169"></a>00169 <span class="comment">//              calcDB(block_imp_size[i], 1, alu[i], block_full_size[i], x+block_index[i], block_imp_size[i], rwork, block_full_size[i]);</span>
<a name="l00170"></a>00170                 <span class="keywordtype">int</span> ldd = block_full_size[i];
<a name="l00171"></a>00171                 <span class="keywordtype">int</span> isize = block_imp_size[i];
<a name="l00172"></a>00172                 B = x+block_index[i];
<a name="l00173"></a>00173                 D = alu[i];
<a name="l00174"></a>00174                 <span class="keywordflow">for</span>(k=0; k&lt;isize; k++) rwork[k] = 0.0;
<a name="l00175"></a>00175                 <span class="keywordflow">for</span>(l=0; l&lt;isize; l++) <span class="keywordflow">for</span>(k=0; k&lt;isize; k++) rwork[k] += B[l]*D[k+l*ldd];
<a name="l00176"></a>00176                 <span class="keywordflow">for</span>(k=0; k&lt;isize; k++) B[k] = rwork[k];
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178         <span class="keyword">delete</span>[] rwork; 
<a name="l00179"></a>00179         <span class="keywordflow">return</span>;
<a name="l00180"></a>00180 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="c88bb3a9595edec29279bb26af45b456"></a><!-- doxytag: member="BILU0_C.h::simRPT" ref="c88bb3a9595edec29279bb26af45b456" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="structSimRPT.html">SimRPT</a> <a class="el" href="BILU0__C_8h.html#c88bb3a9595edec29279bb26af45b456">simRPT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Tue Apr 28 16:09:42 2009 for GPRS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
